---
layout: post
collection: kubernetes
permalink: /kubernetes/helm
title:  "Helm Charts"
author: Paulo Rogério
date:   2025-10-07 06:00:00 -0300
categories: [kubernetes]
published: true
---

# Estudos Helm Chart 

- [1) Propósito](#1-versão-do-helm)
- [2) Usando Helm](#2-usando-helm)
  - [2.1) Criando um Chart](#21-criando-um-chart)
  - [2.2) Estrutura do Chart](#22-estrutura-do-chart)
- [3) Objetos do Helm](#3-objetos-do-helm)
- [4) Funções](#4-funções)
  - [4.1) Quote](#41-quote)


## 1) Propósito

O propósito desse material é garantir o entendimento do Helm para construirmos charts mais robustos.
Não tem o Helm instalado? [Clique Aqui](https://helm.sh/docs/intro/quickstart) para ter as instruções de instalação.

## 2) Usando Helm

Adicionando repositório...

```bash
helm repo list
helm repo add bitnami https://charts.bitnami.com/bitnami
help repo update
```

Sintaxe de instalação...

```bash
                        ( repo )/( pacote)  
helm install my-release bitnami/phpmyadmin
helm list -A
helm list -n namespace
```

Como instalar um determinado release?

```bash
helm install <nome-do-release> <nome-do-repositório>/<nome-do-chart> --version <versão>
helm install meu-prometheus prometheus-community/prometheus --version 25.8.0
```

Desinstalar um deploy

```bash
helm uninstall meu-prometheus
```

#### 2.1) Criando um Chart

Estou criando um chart chamado *meu-chart*. Ao executar o comando, ele já presume e cria alguns manifestos ( deployments, services, hpa...)

```bash
helm create meu-chart
```

#### 2.2) Estrutura do Chart

Após criado o chart, alguns arquivos podem ser excluídos para manter dentro do chart apenas os arquivos necessário para contemplar os estudos.

```bash
echo "" > meu-chart/values.yaml
rm -f meu-chart/templates/*
```

Crie o conteudo do configmap.yaml com a seguinte sintaxe.

```bash
cat > meu-chart/templates/configmap.yaml <<EOF
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
EOF
```

```yaml
├── Chart.yaml
├── templates
│   ├── configmap.yaml
└── values.yaml
```

Executando no modo **dry-run** e validar a saida do manifesto gerado...

```bash
helm install --debug --dry-run meuchart-v1 ./meu-chart
helm install --dry-run meuchart-v1 ./meu-chart
```

```bash
NAME: meuchart-v1
LAST DEPLOYED: Tue Oct  7 09:12:24 2025
NAMESPACE: default
STATUS: pending-install
REVISION: 1
TEST SUITE: None
HOOKS:
MANIFEST:
---
# Source: meu-chart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: meuchart-v1-configmap
data:
  myvalue: "Hello World
```

## 3) Objetos do Helm

**Built-in Objects** são variáveis globais que o motor de templates (Go templating engine) injeta automaticamente quando o Helm renderiza seus manifests.

Como eu descubro o nome dos Objetos nativos do Helm? [Built-in Objects - List](https://helm.sh/docs/chart_template_guide/builtin_objects/)



| Nome                 | Descrição                                                                       | Exemplo                                        |
| -------------------- | ------------------------------------------------------------------------------- | ---------------------------------------------- |
|:---|:---:|---:|
| **.Release**         | Informações sobre a *release* atual (nome, namespace, tempo, etc.)              | **{{ "{{" }} .Release.Name {{ "}} }} → myapp** |
| **.Chart**           | Dados do chart atual (nome, versão, descrição, etc.)                            | **{{ "{{" }} .Chart.Name {{ "}} }} → meu-chart** |
| **.Values**          | Valores vindos do **values.yaml** e **--set**                                   | **{{ "{{" }} .Values.image.repository {{ "}} }}** |
| **.Files**           | Permite ler arquivos dentro do chart                                            | **{{ "{{" }} (.Files.Get "config/app.conf") {{ "}} }}** |
| **.Capabilities**    | Mostra recursos suportados pelo cluster (versão do K8s, APIs, etc.)             | **{{ "{{" }} .Capabilities.KubeVersion.Version {{ "}} }}** |
| **.Template**        | Informações sobre o arquivo de template sendo renderizado                       | **{{ "{{" }} .Template.Name {{ "}} }}**                    |
| -------------------- | ------------------------------------------------------------------------------- | ---------------------------------------------- |


## 4) Funções

Vamos detalhar alguns funções, usadas no dia a dia. O entendimento dessa funções permitirá uma construção mais robusta dos **Helm Chart**. 

##### 4.1) Quote


```bash
cat > meu-chart/values.yaml <<EOF
bebida: refrigerante
favorita:
  bebida: cafe
  comida: pizza
EOF
```

###### String Sem Aspas - Quote

```yaml
cat > meu-chart/templates/configmap.yaml <<EOF
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  bebida: {{ .Values.favorita.bebida }}
  comida: {{ .Values.favorita.comida }}
EOF
```

```bash
helm install --dry-run meu-chart ./meu-chart
```

Observe na saida abaixo que os values não vieram **protegidos** por aspas, o **Helm** espera que eu explicite isso.

```yaml
NAME: meu-chart
LAST DEPLOYED: Tue Oct  7 09:52:14 2025
NAMESPACE: default
STATUS: pending-install
REVISION: 1
TEST SUITE: None
HOOKS:
MANIFEST:
---
# Source: meu-chart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: meu-chart-configmap
data:
  myvalue: "Hello World"
  bebida: cafe
  comida: pizza
```


###### String Com Aspas - Quote

Funções conhecidas como pipeline, ou seja, redireciona a saida de um comando para outro.

```yaml
cat > meu-chart/templates/configmap.yaml <<EOF
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  myvalue: "Hello World"
  bebida: {{ .Values.favorita.bebida | quote }}
  comida: {{ .Values.favorita.comida | quote }}
EOF
```

```bash
helm install --dry-run meu-chart ./meu-chart
```


```yaml
NAME: meu-chart
LAST DEPLOYED: Tue Oct  7 11:11:39 2025
NAMESPACE: default
STATUS: pending-install
REVISION: 1
TEST SUITE: None
HOOKS:
MANIFEST:
---
# Source: meu-chart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: meu-chart-configmap
data:
  myvalue: "Hello World"
  bebida: "cafe"
  comida: "pizza"
```

